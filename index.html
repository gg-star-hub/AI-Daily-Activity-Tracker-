<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Monthly Budget – Wooden Card UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    :root {
      --bg: #f3eee7;
      --bg-soft: #f9f5ef;
      --card: #fdf6ec;
      --card-border: #e0d3c2;
      --card-shadow: 0 14px 35px rgba(87, 65, 45, 0.18);
      --accent: #8b5a2b;
      --accent-soft: rgba(139, 90, 43, 0.12);
      --accent-red: #b91c1c;
      --accent-green: #15803d;
      --text: #3b2f26;
      --muted: #7a6a58;
      --radius-lg: 18px;
      --radius-pill: 999px;
      --transition-fast: 150ms ease-out;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      min-height: 100%;
      overflow-x: hidden;
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: clamp(10px, 4vw, 20px);
      background:
        radial-gradient(circle at top, rgba(214, 191, 160, 0.7) 0, transparent 55%),
        linear-gradient(180deg, #f3eee7 0%, #e7ddcf 45%, #dbcbb8 100%);
      background-attachment: fixed;
      color: var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
    }

    #app {
      width: 100%;
      max-width: 960px;
      background:
        linear-gradient(135deg, rgba(252, 245, 235, 0.98), rgba(245, 234, 217, 0.98));
      border-radius: 24px;
      padding: clamp(16px, 3vw, 24px);
      box-shadow: 0 16px 45px rgba(56, 38, 20, 0.18);
      border: 1px solid rgba(175, 148, 118, 0.7);
      transform-origin: center center; /* for scaling */
    }

    .header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 14px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    h1 {
      font-size: clamp(1.2rem, 2.2vw, 1.6rem);
      margin: 0;
      letter-spacing: 0.01em;
      color: #2f241c;
    }

    .subtitle {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .header-right {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-end;
    }

    .period-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(175, 148, 118, 0.7);
      background: radial-gradient(circle at top, #fdf7ed, #f1e2cf);
      font-size: 0.8rem;
      color: var(--muted);
      box-shadow: 0 8px 18px rgba(87, 65, 45, 0.18);
    }

    .period-pill strong {
      color: var(--text);
      font-weight: 600;
    }

    .currency-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(175, 148, 118, 0.7);
      background: #fbf3e7;
      box-shadow: 0 6px 14px rgba(87, 65, 45, 0.18);
      font-size: 0.78rem;
      color: var(--muted);
    }

    .currency-pill span {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.7rem;
    }

    .currency-select {
      border: none;
      outline: none;
      background: transparent;
      font-size: 0.82rem;
      font-family: inherit;
      color: var(--text);
      padding: 2px 4px;
      cursor: pointer;
    }

    .currency-select option {
      color: #111827;
    }

    .layout {
      display: grid;
      gap: 14px;
    }

    @media (min-width: 900px) {
      form {
        grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.2fr) minmax(0, 0.8fr);
        align-items: end;
      }

      /* Income / Expense toggle above the label row */
      .type-toggle { grid-column: 1 / 4; }
      label[for="labelInput"] { grid-column: 1 / 3; }
      label[for="amountInput"] { grid-column: 3 / 4; }
      button.save {
        grid-column: 1 / 4;
        max-width: 280px;
        justify-self: flex-end;
      }
    }0, 0.8fr);
        align-items: end;
      }

      /* Income / Expense toggle above the label row */
      .type-toggle { grid-column: 1 / 4; }
      label[for="labelInput"] { grid-column: 1 / 3; }
      label[for="amountInput"] { grid-column: 3 / 4; }
      button.save {
        grid-column: 1 / 4;
        max-width: 280px;
        justify-self: flex-end;
      }
    } {
      form {
        grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.2fr) minmax(0, 0.8fr);
        align-items: end;
      }

      /* Income / Expense toggle above the label row */
      .type-toggle { grid-column: 1 / 4; }
      label[for="labelInput"] { grid-column: 1 / 3; }
      label[for="amountInput"] { grid-column: 3 / 4; }
      button.save {
        grid-column: 1 / 4;
        max-width: 280px;
        justify-self: flex-end;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <header class="header">
      <div class="title-block">
        <h1>Monthly Budget Cards</h1>
        <div class="subtitle">Warm, wooden overview of this month’s income and expenses.</div>
      </div>
      <div class="header-right">
        <div class="period-pill" id="periodPill">
          <span>Current month:</span>
          <strong id="periodLabel">—</strong>
        </div>
        <div class="currency-pill">
          <span>Currency</span>
          <select id="currencySelect" class="currency-select" aria-label="Currency selector">
            <option value="EUR">€ · EUR</option>
            <option value="USD">$ · USD</option>
            <option value="JPY">¥ · JPY</option>
            <option value="GBP">£ · GBP</option>
            <option value="CNY">¥ · CNY</option>
            <option value="AUD">A$ · AUD</option>
            <option value="CAD">C$ · CAD</option>
            <option value="CHF">Fr · CHF</option>
            <option value="HKD">HK$ · HKD</option>
            <option value="SGD">S$ · SGD</option>
          </select>
        </div>
      </div>
    </header>

    <main class="layout">
      <section class="card">
        <div class="card-header">
          <div class="card-title">New entry</div>
          <div class="badge-soft">Stored locally</div>
        </div>

        <form id="entryForm">
          <div class="type-toggle" id="typeToggle">
            <button type="button" class="type-btn active income" data-type="income">Income</button>
            <button type="button" class="type-btn expense" data-type="expense">Expense</button>
          </div>
          <label for="labelInput">Label
            <input id="labelInput" type="text" placeholder="Salary, Rent, Groceries, Note" />
          </label>
          <label for="amountInput">Amount (<span id="currencyLabel">€</span>)
            <input id="amountInput" type="number" step="1" min="1" required />
          </label>
          <button type="submit" class="save">Save Entry</button>
        </form>

        <div class="cards-row">
          <div class="mini-card mini-income">
            <div class="mini-label">Income</div>
            <div class="mini-value" id="totalIncome">€0.00</div>
            <div class="mini-sub" id="incomeMeta">0 income entries</div>
          </div>
          <div class="mini-card mini-expense">
            <div class="mini-label">Expenses</div>
            <div class="mini-value" id="totalExpenses">€0.00</div>
            <div class="mini-sub" id="expenseMeta">0 expense entries</div>
          </div>
          <div class="mini-card mini-net" id="netCard">
            <div class="mini-label">Net</div>
            <div class="mini-value" id="netBalance">€0.00</div>
            <div class="mini-sub" id="netMeta">Income − Expenses</div>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="card-header">
          <div class="card-title">This month’s entries</div>
          <div class="badge-soft" id="entryCountLabel">0 entries</div>
        </div>
        <div class="table-shell">
          <div class="table-scroll">
            <table>
              <thead>
                <tr>
                  <th>Label</th>
                  <th>Type</th>
                  <th>Amount</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="tableBody">
                <tr class="empty-row">
                  <td colspan="4">No entries yet. Add your first income or expense for this month.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    (function () {
      const STORAGE_KEY = 'monthly_finance_v1';
      const now = new Date();
      const year = now.getFullYear();
      const monthIndex = now.getMonth();
      const periodKey = year + '-' + String(monthIndex + 1).padStart(2, '0');

      const CURRENCIES = {
        EUR: { symbol: '€', label: 'EUR' },
        USD: { symbol: '$', label: 'USD' },
        JPY: { symbol: '¥', label: 'JPY' },
        GBP: { symbol: '£', label: 'GBP' },
        CNY: { symbol: '¥', label: 'CNY' },
        AUD: { symbol: 'A$', label: 'AUD' },
        CAD: { symbol: 'C$', label: 'CAD' },
        CHF: { symbol: 'Fr', label: 'CHF' },
        HKD: { symbol: 'HK$', label: 'HKD' },
        SGD: { symbol: 'S$', label: 'SGD' }
      };

      const DEFAULT_CURRENCY = 'EUR';

      const periodLabel = document.getElementById('periodLabel');
      periodLabel.textContent = now.toLocaleString(undefined, { month: 'long', year: 'numeric' });

      let raw = {};
      try {
        raw = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
      } catch (_) {
        raw = {};
      }

      if (raw.month !== periodKey || !Array.isArray(raw.entries)) {
        raw = { month: periodKey, currency: raw.currency || DEFAULT_CURRENCY, entries: [] };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(raw));
      }

      let currentCurrency = CURRENCIES[raw.currency]?.label ? raw.currency : DEFAULT_CURRENCY;

      let entries = raw.entries
        .filter(e => e && typeof e.amount === 'number')
        .map(e => ({
          id: e.id || (window.crypto && crypto.randomUUID ? crypto.randomUUID() : String(Date.now() + Math.random())),
          type: e.type === 'expense' ? 'expense' : 'income',
          label: (e.label || [e.category, e.description].filter(Boolean).join(' – ') || '').trim(),
          amount: Number(e.amount) || 0
        }))
        .filter(e => e.amount > 0);

      const labelInput = document.getElementById('labelInput');
      const amountInput = document.getElementById('amountInput');
      const tableBody = document.getElementById('tableBody');
      const totalIncomeEl = document.getElementById('totalIncome');
      const totalExpensesEl = document.getElementById('totalExpenses');
      const netBalanceEl = document.getElementById('netBalance');
      const incomeMetaEl = document.getElementById('incomeMeta');
      const expenseMetaEl = document.getElementById('expenseMeta');
      const netMetaEl = document.getElementById('netMeta');
      const netCard = document.getElementById('netCard');
      const entryCountLabel = document.getElementById('entryCountLabel');
      const currencySelect = document.getElementById('currencySelect');
      const currencyLabel = document.getElementById('currencyLabel');

      let currentType = 'income';
      document.getElementById('typeToggle').addEventListener('click', e => {
        const btn = e.target.closest('.type-btn');
        if (!btn) return;
        currentType = btn.dataset.type;
        document.querySelectorAll('.type-btn').forEach(b => b.classList.toggle('active', b === btn));
      });

      function save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ month: periodKey, currency: currentCurrency, entries }));
      }

      function fmt(x) {
        const c = CURRENCIES[currentCurrency] || CURRENCIES[DEFAULT_CURRENCY];
        return c.symbol + x.toFixed(2);
      }

      function updateCurrencyUI() {
        const c = CURRENCIES[currentCurrency] || CURRENCIES[DEFAULT_CURRENCY];
        currencyLabel.textContent = c.symbol;
        currencySelect.value = currentCurrency;
      }

      function render() {
        if (!entries.length) {
          tableBody.innerHTML = '<tr class="empty-row"><td colspan="4">No entries yet. Add your first income or expense for this month.</td></tr>';
        } else {
          tableBody.innerHTML = entries.map(e => `
            <tr>
              <td>${(e.label || '—').replace(/</g, '&lt;')}</td>
              <td>${e.type}</td>
              <td class="${e.type === 'income' ? 'amount-in' : 'amount-out'}">${fmt(e.amount)}</td>
              <td><button class="delete-btn" type="button" data-id="${e.id}" aria-label="Delete entry">✕</button></td>
            </tr>
          `).join('');
        }

        entryCountLabel.textContent = entries.length === 1 ? '1 entry' : entries.length + ' entries';

        const inc = entries.filter(e => e.type === 'income').reduce((s, e) => s + e.amount, 0);
        const exp = entries.filter(e => e.type === 'expense').reduce((s, e) => s + e.amount, 0);
        const net = inc - exp;

        totalIncomeEl.textContent = fmt(inc);
        totalExpensesEl.textContent = fmt(exp);
        netBalanceEl.textContent = fmt(net);

        const incomeCount = entries.filter(e => e.type === 'income').length;
        const expenseCount = entries.filter(e => e.type === 'expense').length;

        incomeMetaEl.textContent = incomeCount + ' income ' + (incomeCount === 1 ? 'entry' : 'entries');
        expenseMetaEl.textContent = expenseCount + ' expense ' + (expenseCount === 1 ? 'entry' : 'entries');
        netMetaEl.textContent = net >= 0 ? 'Net surplus this month' : 'Net deficit this month';

        netCard.classList.toggle('negative', net < 0);
      }

      tableBody.addEventListener('click', e => {
        const btn = e.target.closest('.delete-btn');
        if (!btn) return;
        const id = btn.dataset.id;
        entries = entries.filter(x => x.id !== id);
        save();
        render();
        fitToViewport();
      });

      document.getElementById('entryForm').addEventListener('submit', e => {
        e.preventDefault();
        const rawAmount = (amountInput.value || '').replace(',', '.');
        const amount = parseFloat(rawAmount);
        if (!isFinite(amount) || amount <= 0) {
          alert('Enter a valid amount greater than 0');
          amountInput.focus();
          return;
        }
        const label = (labelInput.value || '').trim();
        const entry = {
          id: (window.crypto && crypto.randomUUID ? crypto.randomUUID() : String(Date.now() + Math.random())),
          type: currentType === 'expense' ? 'expense' : 'income',
          label,
          amount
        };
        entries.push(entry);
        save();
        render();
        amountInput.value = '';
        labelInput.value = '';
        amountInput.focus();
        fitToViewport();
      });

      currencySelect.addEventListener('change', () => {
        const value = currencySelect.value;
        if (!CURRENCIES[value]) return;
        currentCurrency = value;
        updateCurrencyUI();
        save();
        render();
        fitToViewport();
      });

      function fitToViewport() {
        const app = document.getElementById('app');
        if (!app) return;
        // Ensure no scaling is applied; layout is purely CSS-responsive
        app.style.transform = 'none';
      }

      updateCurrencyUI();
      render();
      window.addEventListener('resize', fitToViewport);
    })();
  </script>
</body>
</html>
